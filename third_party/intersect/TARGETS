load("@fbcode_macros//build_defs:cpp_python_extension.bzl", "cpp_python_extension")
load("@fbcode_macros//build_defs:python_library.bzl", "python_library")

cpp_python_extension(
    name = "cuda_lib",
    srcs = glob(
        [
            "*.cpp",
            "*.cu",
        ],
    ),
    headers = glob(
        [
            "*.h",
        ],
    ),
    nvcc_flags = [
        "-gencode=arch=compute_52,code=\"sm_52,compute_52\"",
        "-gencode=arch=compute_60,code=\"sm_60,compute_60\"",
        "-gencode=arch=compute_70,code=\"sm_70,compute_70\"",
        "-lineinfo",
    ],
    deps = [
        "//caffe2:torch_extension",
    ],
)

python_library(
    name = "lib",
    srcs = glob(
        [
            "*.py",
        ],
    ),
    cpp_deps = [
    ],
    deps = [
        ":cuda_lib",
        "//caffe2:torch",
    ],
)
